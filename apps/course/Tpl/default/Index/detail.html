<include file="__THEME__/public_header_new" />
<link rel="stylesheet" href="__THEME__/js/uploadify/uploadify.css?v={$site.sys_version}" type="text/css">
<script type="text/javascript" src="__THEME__/js/uploadify/jquery.uploadify.min.js"></script>
<div id="main-body" class="mt20">
        <div class="content clearfix">
            <include file="__THEME__/public_left_new" />
            <div class="fr id-section">
                <div class="location"><span>当前位置：</span><a href="javascript:;">首页</a>&gt;<a href="{:U('course/Index/index')}">课程学习-课程资源</a>&gt;<span class="color-gre">课程列表</span></div>
                <div class="fr" style="margin-top:2px;">
                	<div id="fileQueue"></div>
                    <input id="file_upload" name="file_upload" type="file" multiple="true">
                </div>
                <div class="id-table">
                    <table>
                        <tr>
                            <th width="20%">序号</th>
                            <th width="20%">资源类型</th>
                            <th width="50%">资源名称</th>
                            <th width="10%">状态</th>
                        </tr>
                        <volist name="courseresource" id="cr">
	                        <tr <if condition="$i%2 eq 0">class="special"</if>>
	                            <td><span>{$i}</span></td>
	                            <td><span class="tab-ell <if condition='$cr["ext"] eq flv'>type-vid<else/>type-doc</if>"><if condition="$cr['ext'] eq flv">视频<else/>文档</if></span></td>
	                            <td><span class="tab-ell w-l">{$cr['title']}</span></td>
	                            <td><span><if condition="$cr['percent'] eq 100"><a href="{:U('course/Index/video',array(id=>$cr['id']))}">完成</a><else /><if condition="$cr['percent'] eq 0"><a href="{:U('course/Index/video',array(id=>$cr['id']))}">进入学习</a><else /><a href="{:U('course/Index/video',array(id=>$cr['id']))}">继续</a></if></if></span></td>
	                        </tr>
                        </volist>
                       <!--  <tr class="special">
                            <td><span>2</span></td>
                            <td><span class="tab-ell type-doc">文档</span></td>
                            <td><span class="tab-ell w-l">完全平方公式与平方差公式～简单美观风格(八年级数学)</span></td>
                            <td><span>未开始</span></td>
                        </tr>
                        <tr>
                            <td><span>3</span></td>
                            <td><span class="tab-ell type-vid">视频</span></td>
                            <td><span class="tab-ell w-l">完全平方公式与平方差公式～简单美观风格(八年级数学)</span></td>
                            <td><span class="color-red">已结束</span></td>
                        </tr>
                        <tr class="special">
                            <td><span>4</span></td>
                            <td><span class="tab-ell type-txt">文本</span></td>
                            <td><span class="tab-ell w-l">完全平方公式与平方差公式～简单美观风格(八年级数学)</span></td>
                            <td><span class="color-red">已结束</span></td>
                        </tr> -->
                    </table>
                </div>
                <div class="comment-page tc">
                    <!-- <a href="javascript:;" class="clearfix">首页</a>
                    <a href="javascript:;" class="clearfix"><em class="arr-lt"></em><span>上一页</span></a>
                    <a href="javascript:;" class="clearfix">1</a>
                    <a href="javascript:;" class="clearfix">2</a>
                    <a href="javascript:;" class="clearfix">3</a>
                    <a href="javascript:;" class="clearfix"><span>下一页</span><em class="arr-rt"></em></a>
                    <a href="javascript:;" class="clearfix">末页</a> -->
                    {$page}
                </div>
            </div>
        </div>
    </div>
<script>
var courseid = "{$courseid}";
jQuery(document).ready(function(){
	$('#file_upload').uploadify({
		//auto:false,
    	fileTypeExts: "*.flv;*.xls;*.xlsx;*.ppt;*.pptx",
		swf: '__THEME__/js/uploadify/uploadify.swf',
		uploader: "{:U('course/Admin/upload')}",
		width: 115,
		height: 30,
		buttonImage: '__APP__/images/uploadBtn.png',
		queueSizeLimit: 5,
		fileSizeLimit : '100MB',
		queueID: 'fileQueue',
		overrideEvents: ['onSelectError', 'onDialogClose'],
		onUploadSuccess : function(file, data, response) {
			// 解析JSON数据
			var jsondata = $.parseJSON(data);
			if (jsondata.status === 1) {
				//data返回服务端各个参数
				//alert("上传成功");
				var resid = jsondata.resource_id;
				$.ajax({
					type: "POST",
					url: 'index.php?app=course&mod=Admin&act=saveResToCourse',
					data:{"courseid":courseid,"resid":resid},
					dataType: "json",
					async:false,
					success:function(msg){
						if(msg.status == 1){
							window.location.href="index.php?app=course&mod=Index&act=detail&id="+courseid;
						}
					},
					error:function(msg){
						alert("创建失败");
						return;
					}
				});
			}
		},
		onSelectError: function (file, errorCode, errorMsg) {
			switch (errorCode) {
				case -100:
					alert('选择的上传数目超过，您还能上传'+errorMsg+'个视频');
					break;
				case -110:
					alert("文件 [" + file.name + "] 大小超出系统限制的" + $('#upload').uploadify('settings', 'fileSizeLimit') + "大小100MB");
					break;
				case -120:
					alert("文件 [" + file.name + "] 大小异常");
					break;
				case -130:
					alert("文件 [" + file.name + "] 类型不正确");
					break;
			}
		},
		onFallback: function () {
			alert('您未安装FLASH控件，无法上传！请安装FLASH控件后再试');
		},
		onUploadStart: function (file) {
			
		}
	});
});
</script>
<include file="__THEME__/public_footer_new" />
